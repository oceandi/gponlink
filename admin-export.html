<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Admin Panel - GponLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://raw.githubusercontent.com/oceandi/links/refs/heads/main/ISP/images/homepage/logo.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f7;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 18px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 32px;
            color: #1d1d1f;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #0071e3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0077ed;
        }
        
        .btn-success {
            background: #34c759;
            color: white;
        }
        
        .btn-success:hover {
            background: #2da048;
        }
        
        .btn-danger {
            background: #ff3b30;
            color: white;
        }
        
        .btn-danger:hover {
            background: #e6352a;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 600;
            color: #0071e3;
        }
        
        .stat-label {
            font-size: 18px;
            color: #86868b;
            margin-top: 10px;
        }
        
        .orders-table {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .table-header {
            padding: 20px 30px;
            border-bottom: 1px solid #f5f5f7;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f5f5f7;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #1d1d1f;
            font-size: 14px;
        }
        
        td {
            padding: 20px 15px;
            border-bottom: 1px solid #f5f5f7;
            font-size: 15px;
        }
        
        tr:hover {
            background: #fbfbfd;
        }
        
        .no-data {
            text-align: center;
            padding: 60px;
            color: #86868b;
        }
        
        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: #e8f4fd;
            color: #0c5a9e;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 18px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .filter-section label {
            font-weight: 600;
            color: #1d1d1f;
        }
        
        .filter-section input[type="date"] {
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>GponLink Admin Panel</h1>
                <p>Sipari≈ü Y√∂netimi ve Veri Export</p>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="refreshData()">üîÑ Yenile</button>
                <button class="btn btn-success" onclick="exportToExcel()">üìä Excel ƒ∞ndir</button>
                <button class="btn btn-danger" onclick="clearLocalData()">üóëÔ∏è Veriyi Temizle</button>
            </div>
        </div>
        
        <div class="alert alert-info">
            üí° <strong>Bilgi:</strong> Veriler tarayƒ±cƒ±nƒ±zƒ±n yerel depolama alanƒ±nda (LocalStorage) saklanmaktadƒ±r. 
            Google Sheets entegrasyonu aktifse, veriler otomatik olarak senkronize edilir.
        </div>
        
        <div class="filter-section">
            <label>Tarih Filtresi:</label>
            <input type="date" id="startDate" onchange="filterOrders()">
            <span>-</span>
            <input type="date" id="endDate" onchange="filterOrders()">
            <button class="btn btn-primary" onclick="resetFilters()">Filtreleri Temizle</button>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">Toplam Sipari≈ü</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayOrders">0</div>
                <div class="stat-label">Bug√ºnk√º Sipari≈üler</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRevenue">‚Ç∫0</div>
                <div class="stat-label">Toplam Gelir</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgOrderValue">‚Ç∫0</div>
                <div class="stat-label">Ortalama Sipari≈ü</div>
            </div>
        </div>
        
        <div class="orders-table">
            <div class="table-header">
                <h2>Sipari≈ü Listesi</h2>
            </div>
            <div id="ordersContent">
                <div class="no-data">Y√ºkleniyor...</div>
            </div>
        </div>
    </div>
    
    <script>
        let allOrders = [];
        let filteredOrders = [];
        
        // Sayfa y√ºklendiƒüinde veriyi getir
        window.addEventListener('DOMContentLoaded', refreshData);
        
        function refreshData() {
            // LocalStorage'dan veriyi al
            const storedOrders = localStorage.getItem('gponlinkOrders');
            allOrders = storedOrders ? JSON.parse(storedOrders) : [];
            filteredOrders = [...allOrders];
            
            // Tarihe g√∂re sƒ±rala (yeniden eskiye)
            filteredOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            displayOrders();
            updateStats();
        }
        
        function displayOrders() {
            const content = document.getElementById('ordersContent');
            
            if (filteredOrders.length === 0) {
                content.innerHTML = '<div class="no-data">Hen√ºz sipari≈ü yok</div>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Sipari≈ü No</th>
                            <th>Tarih/Saat</th>
                            <th>Ad Soyad</th>
                            <th>Telefon</th>
                            <th>Email</th>
                            <th>√úr√ºn</th>
                            <th>Fiyat</th>
                            <th>ƒ∞l√ße</th>
                            <th>Kurulum</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredOrders.forEach(order => {
                const date = new Date(order.timestamp).toLocaleString('tr-TR');
                const installation = order.installation === 'professional' ? 'Profesyonel' : 'M√º≈üteri';
                const totalPrice = parseFloat(order.price) + (order.installation === 'professional' ? 500 : 0);
                
                html += `
                    <tr>
                        <td style="font-family: monospace; font-weight: 600; color: #0071e3;">${order.orderNumber}</td>
                        <td>${date}</td>
                        <td>${order.firstName} ${order.lastName}</td>
                        <td>${order.phone}</td>
                        <td>${order.email}</td>
                        <td>${order.product}</td>
                        <td>‚Ç∫${totalPrice.toLocaleString('tr-TR')}</td>
                        <td>${order.district}</td>
                        <td>${installation}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }
        
        function updateStats() {
            // Toplam sipari≈ü
            document.getElementById('totalOrders').textContent = filteredOrders.length;
            
            // Bug√ºnk√º sipari≈üler
            const today = new Date().toDateString();
            const todayOrders = filteredOrders.filter(order => 
                new Date(order.timestamp).toDateString() === today
            );
            document.getElementById('todayOrders').textContent = todayOrders.length;
            
            // Toplam gelir
            const totalRevenue = filteredOrders.reduce((sum, order) => {
                const orderTotal = parseFloat(order.price) + (order.installation === 'professional' ? 500 : 0);
                return sum + orderTotal;
            }, 0);
            document.getElementById('totalRevenue').textContent = `‚Ç∫${totalRevenue.toLocaleString('tr-TR')}`;
            
            // Ortalama sipari≈ü deƒüeri
            const avgOrder = filteredOrders.length > 0 ? totalRevenue / filteredOrders.length : 0;
            document.getElementById('avgOrderValue').textContent = `‚Ç∫${Math.round(avgOrder).toLocaleString('tr-TR')}`;
        }
        
        function filterOrders() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            filteredOrders = allOrders.filter(order => {
                const orderDate = new Date(order.timestamp).toDateString();
                const start = startDate ? new Date(startDate).toDateString() : null;
                const end = endDate ? new Date(endDate).toDateString() : null;
                
                if (start && end) {
                    return orderDate >= start && orderDate <= end;
                } else if (start) {
                    return orderDate >= start;
                } else if (end) {
                    return orderDate <= end;
                }
                return true;
            });
            
            displayOrders();
            updateStats();
        }
        
        function resetFilters() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            filteredOrders = [...allOrders];
            displayOrders();
            updateStats();
        }
        
        function exportToExcel() {
            if (filteredOrders.length === 0) {
                alert('Export edilecek veri yok!');
                return;
            }
            
            // Excel i√ßin veri hazƒ±rla
            const excelData = filteredOrders.map(order => ({
                'Sipari≈ü No': order.orderNumber,
                'Tarih': new Date(order.timestamp).toLocaleString('tr-TR'),
                'Ad': order.firstName,
                'Soyad': order.lastName,
                'Telefon': order.phone,
                'Email': order.email,
                '√úr√ºn': order.product,
                '√úr√ºn Fiyatƒ±': parseFloat(order.price),
                'Kurulum': order.installation === 'professional' ? 'Profesyonel' : 'M√º≈üteri',
                'Kurulum √úcreti': order.installation === 'professional' ? 500 : 0,
                'Toplam': parseFloat(order.price) + (order.installation === 'professional' ? 500 : 0),
                'ƒ∞l': order.city,
                'ƒ∞l√ße': order.district,
                'Adres': order.address,
                'Posta Kodu': order.zipCode || ''
            }));
            
            // Worksheet olu≈ütur
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Workbook olu≈ütur
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sipari≈üler');
            
            // Dosya adƒ±
            const fileName = `GponLink_Siparisler_${new Date().toISOString().split('T')[0]}.xlsx`;
            
            // Excel dosyasƒ±nƒ± indir
            XLSX.writeFile(wb, fileName);
        }
        
        function clearLocalData() {
            if (confirm('T√ºm sipari≈ü verilerini silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                localStorage.removeItem('gponlinkOrders');
                refreshData();
                alert('Veriler ba≈üarƒ±yla temizlendi.');
            }
        }
        
        // Her 30 saniyede bir otomatik yenile
        setInterval(refreshData, 30000);
    </script>
</body>
</html>